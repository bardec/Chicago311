<!DOCTYPE html>
<meta charset="utf-8">
<body>
  <style>
    .communityArea {
      fill: none;
      stroke: black;
    }
    .communityArea-boundary {
      fill: none;
      stroke: #777;
      stroke-linejoin: round;
    }
    .selected {
      stroke: red;
    }
  </style>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>
  <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
  <script>
    var ssa_boundries = "resources/communityAreas.json";

    var color = d3.scale.linear().range(["white", "blue"]).domain([0,5]);
    var width = window.innerWidth,
        height = window.innerHeight;

    var svg = d3.select("body").append("svg")
                .attr("width", width)
                .attr("height", height);

    var projection = d3.geo.mercator()
      .translate([width/2, height/2])
      .center([-87.6692, 41.8500])
      .scale(50000);

    var data;
    var collection = [];

    d3.csv("resources/income.csv", function(income){
      data = income;
      d3.json(ssa_boundries, function(error, chicago) {
        if (error) return console.error(error);
        var communities = topojson.feature(chicago, chicago.objects.commAreas);
        var path = d3.geo.path().projection(projection);
        svg.selectAll(".communityArea")
          .data(communities.features)
          .enter().append("path")
          .attr("class", "communityArea")
          .attr("id", function(d,i) { return "communities " + i })
          .attr("d", path)
          .style("fill", function(d){
            if(income[d.id-1]["HARDSHIP INDEX"] >= 0 && income[d.id-1]["HARDSHIP INDEX"] < 20){return color(0)}
            else if(income[d.id-1]["HARDSHIP INDEX"] >= 20 && income[d.id-1]["HARDSHIP INDEX"] < 40) {return color(1)}
            else if(income[d.id-1]["HARDSHIP INDEX"] >= 40 && income[d.id-1]["HARDSHIP INDEX"] < 60) {return color(2)}
            else if(income[d.id-1]["HARDSHIP INDEX"] >= 60 && income[d.id-1]["HARDSHIP INDEX"] < 80) {return color(3)}
            else {return color(4)};
          })
        .append("title")
          .text(function(d){ return income[d.id-1]["CommunityAreaNumber"];});

        svg.selectAll('.communityArea').on('click', function(d) {
          if (collection.indexOf(d3.select(this).attr('id')) != -1) {
            collection.splice(collection.indexOf(d3.select(this).attr('id')),1);
            d3.select(this).classed("selected", false);
          } else {
            new_this = d3.select(this.parentNode.appendChild(this)).classed("selected", true);
            collection.push(d3.select(this).attr('id'));
          }
          d3.event.stopPropagation();
        });
      });
    })

$('document').ready(function() {
  $(':radio').click(function() {
    switch($('input[name=filter]:checked').val()) {
      case 'hardship':
        svg.selectAll('.communityArea').style("fill", function(d) {
          var color = d3.scale.linear().range(["white", "blue"]).domain([0,5]);
          var hardship = data[d.id-1]["HARDSHIP INDEX"];
          if(0 <= hardship && hardship < 20)
            return color(0);
          else if(20 <= hardship && hardship < 40)
            return color(1);
          else if(40 <= hardship && hardship < 60)
            return color(2);
          else if(60 <= hardship && hardship < 80)
            return color(3);
          else
            return color(4);
        });
        break;
      case 'income':
        svg.selectAll('.communityArea').style("fill", function(d) {
          var color = d3.scale.linear().range(["white", "green"]).domain([0,5]);
          var income = data[d.id-1]["PER CAPITA INCOME"];
          if(0 <= income && income <= 9075)
            return color(0);
          else if(9076 <= income && income <= 36900)
            return color(1);
          else if(36901 <= income && income <= 89350)
            return color(2);
          else if(89351 <= income && income < 186350)
            return color(3);
          else
            return color(4);
        });
        break;
      default:
        break;
    }
  });
});

  </script>
  <form action="">
    <input type="radio" name="filter" value="hardship">Hardship<br>
    <input type="radio" name="filter" value="income">Income
  </form>
</body>

